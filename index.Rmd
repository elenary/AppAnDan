--- 
title: "Прикладной анализ данных"
author: "Елена Рыбина"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography:
- book.bib
- packages.bib
description: |
  Занятие по прикладному анализу данных.
link-citations: yes
github-repo: elenary/AppAnDan
---
```{r, eval=TRUE,echo=FALSE}
library(tidyverse)
library(viridis)
library(knitr)
```
# Чек-лист работы с данными

Рассмотрим, как должен выглядеть чек-лист работы с данными для проверки себя, если бы эти экспериментальные данные мы собирали бы сами?

-----Теоретический этап, планирование работы с данными-----

1. Сформулированы теоретические гипотезы.
2. Сформулированы экспериментальные гипотезы.
3. Есть понимание, как будут выглядеть собранные данные.
4. Исходя из гипотезы и того, как будут собраны и какие это данные, выбран статистический метод проверки экспериментальной гипотезы *(и хорошо, если есть понимание о статистической гипотезе -- это уже про H0 и H1)*
5. Выбрана среда для анализа данных и конкретная функция под выбранный статистический критерий (или несколько функций) *(если нужно - установлен пакет для выбранных функций)*.

-----Данные собраны-----

6. Собранные данные предобработаны и приведены в вид, к которому можно применить выбранный статистический критерий и выполнить выбранную функцию.
7. Выбранные для анализа предобработанные переменные исследованы описательными статистиками и предварительно визуализированы для общего понимания).
8. Проведен расчет выбранного статистического критерия с помощью выбранной функции.
9. Вид полученных результатов понятен для интерпретации, и результаты согласуются с представлением о том, как они должны выглядеть.
10. Результаты проинтепретированы и сделан вывод относительно статистической и экспериментальной гипотез.
11. Результаты визуализированы, так, чтобы их было легче правильно воспринять.

Теперь пройдемся подробнее по некоторым из этих пунктов.

В качестве примера возьмем датасет с kaggle <https://www.kaggle.com/datasets/uciml/student-alcohol-consumption>.
Это -- данные из двух португальских школ (скорее колледжей) с подробной социо-демографической информации о студентах, включая ту, как они учатся по математике и португальскому языку и как часто пьют алкоголь. Этот датасет я взяла, так как он содержит переменные разного типа данных в разных шкалах (и шкала отношений, например, возраст, и порядковая шкала, например, рейтинггования образования мамы или папы или поддержка в семье).

```{r, eval=TRUE}
studens_mat <- read_csv("student-mat.csv")
studens_mat %>% 
  rename_with(., ~ paste0(., "_mat"), .cols = c(absences, paid, G1, G2, G3)) -> studens_mat #переименовываю колонки для упрощения понимания, какие относятся к математикие
knitr::kable(studens_mat[1:10,]) #визуализирую табличку для этой книжки
```

```{r, eval=TRUE}
studens_por <- read_csv("student-por.csv")
studens_por %>% 
  rename_with(., ~ paste0(., "_por"), .cols = c(absences, paid, G1, G2, G3)) -> studens_por
knitr::kable(studens_por[1:10,]) #визуализирую табличку для этой книжки
```


## Сформулированы теоретические гипотезы

*<Здесь на парах мы придумывали гипотезы>*

Возьмем первую придуманную гипотезу: в датасете есть студенты возрастов от 15 до 22 двух лет. Возможно, `те, кто младше, будут бояться признаться в употрблении алкоголя и отвечать так, будто не употрябляют его`. Они вляются несовершеннолетними и могут бояться, что родители узнают.

Эта гипотеза хороша тем, что она имеет понятное теоретическое обоснование, она проверяема на наших данных, и данные подходят для того, чтобы ее проверить

Вторая гипотеза: `студенты с менее поддерживающими отношениями в семье чаще употребляют алкоголь`. Эта гипотеза так же понятна, имеет теоретическое обосноование, проверяема в исследовании, и наши данные подходят для ее проверки.


**bookdown** 
*must*
`index.Rmd`


## Сформулированы экспериментальные гипотезы

Гипотеза 1 в контексте нашего исследования и существующих переменных звучит так: `студенты возраста 15-17 лет при ответе на вопрос об употреблении алкоголя в рабочие дни (переменная Dalc) будут выбирать варианты ответов, ассоциированные с как можно более редким употреблением - 1 или 2`

Гипотеза 2 `Студенты, кто оценивает отношения с родителями как менее поддерживающие (переменная famrel, значения 1-2), чаще употребляют алкоголь (переменная Dalc, значения 4-5)`


```{r, eval=TRUE}

```

## Есть понимание, как будут выглядеть собранные данные

Здесь мы работаем с уже готовым датасетом, поэтому понимание о собранных данных у нас есть, и мы уже даже объединили несколько табличек в одну - `students`.

## Исходя из гипотезы и того, как будут собраны и какие это данные, выбран статистический метод проверки экспериментальной гипотезы

В нашем случае все не совсем так, и мы пытаемся прикрутить гипотезу к уже собранным данным -- никогда так не делайте (или делайте, но хорошо подумайте, уверены ли вы в том, что делаете?)

## Выбрана среда для анализа данных и конкретная функция под выбранный статистический критерий (или несколько функций) (если нужно - установлен пакет для выбранных функций)

Как вы уже догадались, я обрабатываю данные в R.

## Собранные данные предобработаны и приведены в вид, к которому можно применить выбранный статистический критерий и выполнить выбранную функцию

Ура, наконец-то мы на этапе, где уже собраны данные! Я немного предобработаю их, чтобы дальше было проще с ними работать. Не недооценивайте предобработку: опытные аналитики говорят, что примерно 80%-90% анализа данных составляет предобработка, и только оставшиеся -- собственно выполнение ключевой функции и получение целевой цифры.

```{r, eval=TRUE}
studens_mat %>% 
  full_join(studens_por, by = c("school","sex","age","address","famsize","Pstatus","Medu","Fedu",
                             "Mjob","Fjob","reason", "guardian", "traveltime","studytime", "failures", "schoolsup", "famsup",
                             "activities", "nursery", "higher", "internet", "romantic", "famrel", "freetime", "goout", 
                             "Dalc", "Walc", "health")) -> students #объединяю две таблички в одну
```

```{r, eval=TRUE}
students %>% 
  mutate("student" = paste0("id", row_number()), .before = "school") -> students #добавляю колонку с айдишником и перезаписываю результат в датасет
students %>% 
  drop_na() -> students #пропускаю строки с NA и перезаписываю результат в датасет
knitr::kable(students[1:10,]) 
```

## Выбранные для анализа предобработанные переменные исследованы описательными статистиками и предварительно визуализированы для общего понимания)

Теперь давайте поизучаем данные. Как ведут себя выбранные для анализа переменные? Что это за данные: в какой шкале они записаны, непрерывные или дискретные? Каковы максимальные и миниамальные значения? А самые встречающиеся? Какова вообще встречаемость разных значений?

Такое описание данных называется **описательными статистиками (descipritve stats)**, потому что, как уже понятно, описывает наши данные. Это идет в разрез со **статистиками вывода (inferential stats)**, когда мы делаем выводы относительно гипотез -- сравнение двух выборов, определение предикторов в линейной регрессии и так далее. Рассмотрим описательные статистики подробнее

### Описательные статистики и визуализации

```{r, eval=TRUE}
students %>% 
  ggplot(aes(x=Walc)) +
  geom_histogram(binwidth = 0.5) +
  theme_minimal()
```

Только что мы нарисовали самый очевидный и нужный график
```{r, eval=TRUE}
students %>% 
  ggplot(aes(x=Walc, y = age)) +
  geom_boxplot(aes(fill = as.factor(Walc))) +
  theme_minimal()
```

## Проведен расчет выбранного статистического критерия с помощью выбранной функции
## Вид полученных результатов понятен для интерпретации, и результаты согласуются с представлением о том, как они должны выглядеть
## Результаты проинтепретированы и сделан вывод относительно статистической и экспериментальной гипотез
## ВРезультаты визуализированы, так, чтобы их было легче правильно воспринять

<!--chapter:end:index.Rmd-->


